var y=Object.defineProperty;var w=(a,t,e)=>t in a?y(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var f=(a,t,e)=>(w(a,typeof t!="symbol"?t+"":t,e),e);import{Y as p}from"./index-AxA5fzg9.js";import{c as D,d as l,q as g,g as b,b as h,e as x,T as u,f as I,h as S,i as k,u as N}from"./client-store-C8eL2Y9E.js";class d{static async getAllControls(){const t=D(l,this.tableName),e=g(t);try{const n=await b(e),r=[];return n.forEach(c=>{var o,i,s,m,C;r.push({id:c.id,clientID:(o=c.data())==null?void 0:o.clientID,subject:(i=c.data())==null?void 0:i.subject,duration:+((s=c.data())==null?void 0:s.duration),nextCheck:(m=c.data())==null?void 0:m.nextCheck,date:(C=c.data())==null?void 0:C.date})}),r}catch(n){return console.warn(n),null}}static async getControlByID(t){var n,r,c,o,i;const e=h(l,this.tableName,t);try{const s=await x(e);return s.exists()?{id:s.id,clientID:(n=s.data())==null?void 0:n.clientID,subject:(r=s.data())==null?void 0:r.subject,duration:(c=s.data())==null?void 0:c.duration,nextCheck:(o=s.data())==null?void 0:o.nextCheck,date:(i=s.data())==null?void 0:i.date}:(console.log("No such document!"),null)}catch(s){return console.warn(s),null}}static async updateControl(t){const e=h(l,this.tableName,t.id),n={...t};n.subject=t.subject,n.date=u.fromDate(new Date(n.date.toString())),n.nextCheck=u.fromDate(new Date(n.nextCheck.toString())),n.clientID=n.clientID,delete n.client;try{return await I(e,n),!0}catch(r){return console.warn(r),!1}}static async addNewControl(t){const e={...t};e.date=u.fromDate(new Date(e.date.toString())),e.nextCheck=u.fromDate(new Date(e.nextCheck.toString())),delete e.client;try{return(await S(D(l,this.tableName),e)).id}catch(n){return console.warn(n),!1}}static async deleteControlByID(t){try{return await k(h(l,this.tableName,t)),!0}catch(e){return console.warn(e),!1}}}f(d,"tableName","controls");const A=p("ControlStore",{state:()=>({items:[]}),actions:{async fetchControls(){const a=t=>t.toDate().toLocaleDateString("en-CA",{day:"2-digit",month:"2-digit",year:"numeric"});try{const t=N();t.items.length||await t.fetchClients();const e=await d.getAllControls(),n=e==null?void 0:e.map(r=>{r.date=a(r.date),r.nextCheck=a(r.nextCheck);const c=t.items.find(o=>o.id===r.clientID);return{...r,client:c}});this.items=n}catch(t){console.warn(t)}},async removeControl(a){try{await d.deleteControlByID(a);const t=this.items.findIndex(e=>e.id===a);return t>=0&&this.items.splice(t,1),!0}catch(t){return console.warn(t),!1}},async addControl(a){var t;try{const e=await d.addNewControl(a);return(t=this.items)==null||t.push({...a,id:e}),!0}catch(e){return console.warn(e),!1}},async updateControl(a){try{return await d.updateControl(a),!0}catch(t){return console.warn(t),!1}}},getters:{getControlById:a=>t=>a==null?void 0:a.items.find(e=>e.id===t),getAllControlsByClientId:a=>t=>a==null?void 0:a.items.filter(e=>e.clientID===t)}});export{d as C,A as u};
